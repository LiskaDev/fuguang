<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: transparent;
  }
  #container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease-in;
  }
  #container.squash {
    transform: scaleY(0);
    transition: transform 0.2s ease-in;
  }
  #container.stretch {
    transform: scaleY(1);
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  dotlottie-player {
    width: 100%;
    height: 100%;
    background: transparent;
  }
</style>
</head>
<body>
<div id="container">
  <dotlottie-player id="player"
    autoplay loop mode="normal"
    style="width:100%;height:100%">
  </dotlottie-player>
</div>

<script src="dotlottie-player.mjs" type="module"></script>

<script type="module">
  const container = document.getElementById('container');
  const player = document.getElementById('player');
  let pendingSource = null;

  // 等待 dotlottie-player 组件注册完成
  async function waitForPlayer() {
    while (!customElements.get('dotlottie-player')) {
      await new Promise(r => setTimeout(r, 50));
    }
  }

  // 加载指定 Lottie JSON（无过渡，用于初始化）
  window.loadEmoji = async function(jsonPath) {
    await waitForPlayer();
    player.load(jsonPath);
  };

  // 带压扁弹开过渡切换 Emoji
  window.switchEmoji = function(jsonPath) {
    pendingSource = jsonPath;
    container.classList.remove('stretch');
    container.classList.add('squash');
  };

  // 压扁完成 → 换图 → 弹开
  container.addEventListener('transitionend', function(e) {
    if (e.propertyName !== 'transform') return;

    if (container.classList.contains('squash') && pendingSource) {
      // 压扁完成，换图
      player.load(pendingSource);
      pendingSource = null;
      // 触发弹开
      container.classList.remove('squash');
      container.classList.add('stretch');
    }
    // 弹开完成，清除 class
    else if (container.classList.contains('stretch')) {
      container.classList.remove('stretch');
    }
  });
</script>
</body>
</html>
