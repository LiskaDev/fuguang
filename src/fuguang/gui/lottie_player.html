<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: transparent;
    }

    #container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      /* 3D 透视（旋转效果需要） */
      perspective: 400px;
    }

    dotlottie-player {
      width: 100%;
      height: 100%;
      background: transparent;
    }

    /* === 过渡效果 @keyframes === */

    /* 1. squash: 压扁弹开（经典） */
    @keyframes exit-squash {
      0% {
        transform: scaleY(1) scaleX(1);
      }

      100% {
        transform: scaleY(0) scaleX(1.2);
      }
    }

    @keyframes enter-squash {
      0% {
        transform: scaleY(0) scaleX(1.2);
      }

      50% {
        transform: scaleY(1.15) scaleX(0.9);
      }

      70% {
        transform: scaleY(0.95) scaleX(1.03);
      }

      100% {
        transform: scaleY(1) scaleX(1);
      }
    }

    /* 2. spin: 3D Y轴旋转 */
    @keyframes exit-spin {
      0% {
        transform: rotateY(0deg);
        opacity: 1;
      }

      100% {
        transform: rotateY(90deg);
        opacity: 0;
      }
    }

    @keyframes enter-spin {
      0% {
        transform: rotateY(-90deg);
        opacity: 0;
      }

      100% {
        transform: rotateY(0deg);
        opacity: 1;
      }
    }

    /* 3. bounce: 缩放弹跳 */
    @keyframes exit-bounce {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(0);
        opacity: 0;
      }
    }

    @keyframes enter-bounce {
      0% {
        transform: scale(0);
      }

      40% {
        transform: scale(1.2);
      }

      60% {
        transform: scale(0.9);
      }

      80% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    /* 4. fade: 优雅淡入淡出 */
    @keyframes exit-fade {
      0% {
        opacity: 1;
        transform: scale(1);
      }

      100% {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    @keyframes enter-fade {
      0% {
        opacity: 0;
        transform: scale(0.8);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* 5. flip: X轴翻转 */
    @keyframes exit-flip {
      0% {
        transform: rotateX(0deg);
        opacity: 1;
      }

      100% {
        transform: rotateX(90deg);
        opacity: 0;
      }
    }

    @keyframes enter-flip {
      0% {
        transform: rotateX(-90deg);
        opacity: 0;
      }

      100% {
        transform: rotateX(0deg);
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div id="container">
    <dotlottie-player id="player" autoplay loop mode="normal" style="width:100%;height:100%">
    </dotlottie-player>
  </div>

  <script src="dotlottie-player.mjs" type="module"></script>

  <script type="module">
    const container = document.getElementById('container');
    const player = document.getElementById('player');
    let pendingSource = null;
    let isAnimating = false;

    // 过渡效果列表
    const EFFECTS = ['squash', 'spin', 'bounce', 'fade', 'flip'];

    // 各效果的时长配置 (ms)
    const TIMING = {
      squash: { exit: 180, enter: 300 },
      spin: { exit: 200, enter: 250 },
      bounce: { exit: 200, enter: 350 },
      fade: { exit: 200, enter: 250 },
      flip: { exit: 200, enter: 250 },
    };

    // 等待 dotlottie-player 组件注册完成
    async function waitForPlayer() {
      while (!customElements.get('dotlottie-player')) {
        await new Promise(r => setTimeout(r, 50));
      }
    }

    // 加载指定 Lottie JSON（无过渡，用于初始化）
    window.loadEmoji = async function (jsonPath) {
      await waitForPlayer();
      player.load(jsonPath);
    };

    // 随机选一种过渡效果切换 Emoji
    window.switchEmoji = function (jsonPath) {
      if (isAnimating) {
        // 动画进行中，更新目标但不重复触发
        pendingSource = jsonPath;
        return;
      }

      pendingSource = jsonPath;
      isAnimating = true;

      // 随机选择效果
      const effect = EFFECTS[Math.floor(Math.random() * EFFECTS.length)];
      const timing = TIMING[effect];

      // 播放退出动画
      container.style.animation = `exit-${effect} ${timing.exit}ms ease-in forwards`;

      // 退出完成 → 换图 → 播放进入动画
      container.addEventListener('animationend', function onExitEnd() {
        container.removeEventListener('animationend', onExitEnd);

        // 换图
        if (pendingSource) {
          player.load(pendingSource);
          pendingSource = null;
        }

        // 播放进入动画
        container.style.animation = `enter-${effect} ${timing.enter}ms ease-out forwards`;

        container.addEventListener('animationend', function onEnterEnd() {
          container.removeEventListener('animationend', onEnterEnd);
          // 清除动画，恢复初始状态
          container.style.animation = '';
          isAnimating = false;
        });
      });
    };
  </script>
</body>

</html>